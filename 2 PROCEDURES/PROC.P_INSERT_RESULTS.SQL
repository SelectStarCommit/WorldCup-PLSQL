create or replace PROCEDURE P_INSERT_RESULTS IS


    VI_MATCH_NO NUMBER;
    VI_MATCH_GROUP VARCHAR2(20);
    VI_TEAM_1 VARCHAR2(20);
    VI_TEAM_1_SCORE NUMBER;
    VI_TEAM_2 VARCHAR2(20);
    VI_TEAM_2_SCORE NUMBER;

    VO_MATCH_NO NUMBER;
    VO_NATION VARCHAR2(20);
    VO_OPPONENT VARCHAR2(20);
    VO_RESULT VARCHAR2(20);
    VO_GF NUMBER;
    VO_GA NUMBER;
    VO_GD NUMBER;
    VO_POINTS NUMBER;

CURSOR C_MATCHES IS
    SELECT MATCH_NO, MATCH_GROUP, TEAM_1, TEAM_1_SCORE, TEAM_2, TEAM_2_SCORE FROM WORLDCUP_MATCHES;
    --R_MATCH C_MATCHES%ROWTYPE;

BEGIN
DELETE FROM WORLDCUP_RESULTS;
--COMMIT;

    OPEN C_MATCHES;
    LOOP
        FETCH C_MATCHES INTO VI_MATCH_NO, VI_MATCH_GROUP, VI_TEAM_1, VI_TEAM_1_SCORE, VI_TEAM_2, VI_TEAM_2_SCORE;
        EXIT WHEN C_MATCHES%NOTFOUND;

        IF ((VI_TEAM_1_SCORE - VI_TEAM_2_SCORE) > 0) THEN VO_RESULT := 'W';
            ELSIF ((VI_TEAM_1_SCORE - VI_TEAM_2_SCORE) < 0) THEN VO_RESULT := 'L';
            ELSIF ((VI_TEAM_1_SCORE - VI_TEAM_2_SCORE) = 0) THEN VO_RESULT := 'D';
        END IF;
        
        VO_GD := (VI_TEAM_1_SCORE - VI_TEAM_2_SCORE);
        
        IF (VO_RESULT = 'W') THEN VO_POINTS := 3;
            ELSIF (VO_RESULT = 'D') THEN VO_POINTS := 1;
            ELSIF (VO_RESULT = 'L') THEN VO_POINTS := 0;
        END IF;
        
        INSERT INTO WORLDCUP_RESULTS (MATCH_NO,NATION,OPPONENT,RESULT,GF,GA,GD,POINTS) 
            VALUES (VI_MATCH_NO,VI_TEAM_1,VI_TEAM_2,VO_RESULT,VI_TEAM_1_SCORE,VI_TEAM_2_SCORE,VO_GD,VO_POINTS);

    END LOOP;
    CLOSE C_MATCHES;
    
    OPEN C_MATCHES;
    LOOP
        FETCH C_MATCHES INTO VI_MATCH_NO, VI_MATCH_GROUP, VI_TEAM_1, VI_TEAM_1_SCORE, VI_TEAM_2, VI_TEAM_2_SCORE;
        EXIT WHEN C_MATCHES%NOTFOUND;

        IF ((VI_TEAM_2_SCORE - VI_TEAM_1_SCORE) > 0) THEN VO_RESULT := 'W';
            ELSIF ((VI_TEAM_2_SCORE - VI_TEAM_1_SCORE) < 0) THEN VO_RESULT := 'L';
            ELSIF ((VI_TEAM_2_SCORE - VI_TEAM_1_SCORE) = 0) THEN VO_RESULT := 'D';
        END IF;
        
        VO_GD := (VI_TEAM_2_SCORE - VI_TEAM_1_SCORE);
        
        IF (VO_RESULT = 'W') THEN VO_POINTS := 3;
            ELSIF (VO_RESULT = 'D') THEN VO_POINTS := 1;
            ELSIF (VO_RESULT = 'L') THEN VO_POINTS := 0;
        END IF;
        
        INSERT INTO WORLDCUP_RESULTS (MATCH_NO,NATION,OPPONENT,RESULT,GF,GA,GD,POINTS) 
            VALUES (VI_MATCH_NO,VI_TEAM_2,VI_TEAM_1,VO_RESULT,VI_TEAM_2_SCORE,VI_TEAM_1_SCORE,VO_GD,VO_POINTS);

    END LOOP;
    CLOSE C_MATCHES;    
END;