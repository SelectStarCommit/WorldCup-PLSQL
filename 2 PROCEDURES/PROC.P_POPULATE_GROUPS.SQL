create or replace PROCEDURE P_POPULATE_GROUPS IS

    VI_WC_GROUP VARCHAR2(20);
    VI_NATION VARCHAR2(20);
    VO_WIN NUMBER;
    VO_DRAW NUMBER;
    VO_LOSS NUMBER;
    VO_GF NUMBER;
    VO_GA NUMBER;
    VO_GD NUMBER;
    VO_POINTS NUMBER;

CURSOR C_NATIONS IS
    SELECT WC_GROUP, NATION FROM WORLDCUP_TEAMS;

BEGIN
DELETE FROM WORLDCUP_GROUPS;

    OPEN C_NATIONS;
    LOOP
        FETCH C_NATIONS INTO VI_WC_GROUP, VI_NATION;
        EXIT WHEN C_NATIONS%NOTFOUND;

        SELECT COUNT(WORLDCUP_RESULTS.RESULT) INTO VO_WIN
            FROM WORLDCUP_RESULTS
            WHERE WORLDCUP_RESULTS.NATION = VI_NATION
            AND WORLDCUP_RESULTS.MATCH_NO <= 48
            AND WORLDCUP_RESULTS.RESULT = 'W';
        
        SELECT COUNT(WORLDCUP_RESULTS.RESULT) INTO VO_DRAW
            FROM WORLDCUP_RESULTS
            WHERE WORLDCUP_RESULTS.NATION = VI_NATION
            AND WORLDCUP_RESULTS.MATCH_NO <= 48
            AND WORLDCUP_RESULTS.RESULT = 'D';
            
        SELECT COUNT(WORLDCUP_RESULTS.RESULT) INTO VO_LOSS
            FROM WORLDCUP_RESULTS
            WHERE WORLDCUP_RESULTS.NATION = VI_NATION
            AND WORLDCUP_RESULTS.MATCH_NO <= 48
            AND WORLDCUP_RESULTS.RESULT = 'L';
        
        SELECT SUM(WORLDCUP_RESULTS.GF) INTO VO_GF
            FROM WORLDCUP_RESULTS
            WHERE WORLDCUP_RESULTS.NATION = VI_NATION
            AND WORLDCUP_RESULTS.MATCH_NO <= 48;
            
        SELECT SUM(WORLDCUP_RESULTS.GA) INTO VO_GA
            FROM WORLDCUP_RESULTS
            WHERE WORLDCUP_RESULTS.NATION = VI_NATION
            AND WORLDCUP_RESULTS.MATCH_NO <= 48;
            
        VO_GD := (VO_GF - VO_GA);

        SELECT SUM(WORLDCUP_RESULTS.POINTS) INTO VO_POINTS
            FROM WORLDCUP_RESULTS
            WHERE WORLDCUP_RESULTS.NATION = VI_NATION
            AND WORLDCUP_RESULTS.MATCH_NO <= 48;
            
        INSERT INTO WORLDCUP_GROUPS(WC_GROUP,NATION,WIN,DRAW,LOSS,GF,GA,GD,POINTS)
            VALUES(VI_WC_GROUP,VI_NATION,VO_WIN,VO_DRAW, VO_LOSS,VO_GF,VO_GA,VO_GD,VO_POINTS);

    END LOOP;
    CLOSE C_NATIONS;
END;